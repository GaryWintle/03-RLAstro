---
import { Image } from "astro:assets";

---
<div class="image-collage">




  <script>
    // Use Vite's import.meta.glob to dynamically import images from a folder
    const imageModules = import.meta.glob(
      "../assets/homepage/gallery/*.{png,jpg,jpeg,gif,webp}",
      { eager: true }
    );
  
    // Convert the modules object to an array of image URLs
    const imageLibrary = Object.keys(imageModules).map((path) => new URL(path, import.meta.url).href);

  
    const collageContainer = document.querySelector(".image-collage");
  
    // Track the currently displayed images
    let currentImages = [];
  
    // Initialize collage with unique images
    const initialImages = getUniqueImages(9);
    currentImages = [...initialImages];
  
    // Render initial images
    collageContainer.innerHTML = initialImages
      .map(
        (img) => `
          <Image src="${img}" alt="Dynamic collage poop" class="collage-image">
        `
      )
      .join("");
  
    // Get a specified number of unique images
    function getUniqueImages(count, excludeImages = []) {
      const availableImages = imageLibrary.filter(
        (img) => !excludeImages.includes(img)
      );
  
      // Shuffle available images and return the required number
      return shuffleArray(availableImages).slice(0, count);
    }
  
    // Shuffle an array
    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }
  </script>